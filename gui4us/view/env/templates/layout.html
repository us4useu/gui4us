{% extends base %}

{% block postamble %}
<!-- https://shoelace.style/ -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.19/dist/shoelace/shoelace.css">
<script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.0.0-beta.19/dist/shoelace/shoelace.esm.js"></script>
<style>
    body, .bk-root .bk, .bk-root .bk:before, .bk-root .bk:after {
        font-family: var(--sl-input-font-family);
    }
</style>
{% endblock %}

<!-- goes in body -->
{% block contents %}
<div id="main" style="">
    <div id="gui4us-header">
        {{ embed(roots.header) }}
    </div>
    <!--Main content-->
    <div id="gui4us-content">
<!--Place for golden layout content.-->
    </div>
<!--Dialog window-->
    <br/>
    <!-- https://shoelace.style/components/dialog -->
    <sl-dialog label="{{dialog_title}}" class="dialog-overview" style="--width: 800px;--height: 300px;">
        {{ embed(roots.dialog) }}
    <sl-button slot="footer" type="primary">Open</sl-button>
    </sl-dialog>
</div>

<!--Dialog window-->
<script>
(() => {
    const dialog = document.querySelector('.dialog-overview');
    {% if dialog_autostart %}
        window.addEventListener("DOMContentLoaded", function() {
            dialog.show();
        }, false);
    {% endif %}
})();
</script>

<!--Layout -->
<style>
:host {
    width: auto;
}
</style>

<script>
var config = {
    settings: {
        hasHeaders: true,
        constrainDragToContainer: true,
        reorderEnabled: true,
        selectionEnabled: false,
        popoutWholeStack: false,
        blockedPopoutsThrowError: true,
        closePopoutsOnUnload: true,
        showPopoutIcon: false,
        showMaximiseIcon: true,
        showCloseIcon: false
    },
    content: [{
        type: 'row',
        content:[
            {
                type: 'component',
                componentName: 'view',
                componentState: { model: 'Control panel',
                                  title: 'Controls',
                                  width: 350,
                                  css_classes:['scrollable']},
                isClosable: false,
            },
            {
                type: 'column',
                content: [
                    {
                        type: 'row',
                        content:[
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: { model: 'B-mode', title: 'B-mode'},
                                isClosable: false,
                            },
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: { model: '{{embed(roots.main)}}', title: 'NN-B-mode'},
                                isClosable: false,
                            }
                        ]
                    },
                    {
                        type: 'row',
                        content:[
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: { model: 'Environments', title: 'Environments'},
                                isClosable: false,
                            },
                            {
                                type: 'component',
                                componentName: 'view',
                                componentState: { model: 'NN-bmode', title: 'NN-B-mode'},
                                isClosable: false,
                            }
                        ]
                    }
                ]
            }
        ]
    }]
};

var myLayout = new GoldenLayout(config, "#gui4us-content");
$("#gui4us-content").css({width: "100vw", height: "100vh", margin: "0px"});

myLayout.registerComponent('view', function(container, componentState){
    const {width, css_classes} = componentState;
    if(width) {
        container.on('open', () => container.setSize(width, container.height));
    }
    if (css_classes) {
        css_classes.map((item) => container.getElement().addClass(item));
    }
    container.setTitle(componentState.title);
    container.getElement().html(componentState.model);
    container.on('resize', () => window.dispatchEvent(new Event('resize')));
});

myLayout.init();
</script>


{% endblock %}